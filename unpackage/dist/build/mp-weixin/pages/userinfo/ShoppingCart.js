(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/userinfo/ShoppingCart"],{"0a77":function(t,i,a){"use strict";a("4651");var e=s(a("b0ce")),n=s(a("c24d"));function s(t){return t&&t.__esModule?t:{default:t}}Page((0,e.default)(n.default))},"1a51":function(t,i,a){},3731:function(t,i,a){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var e=n(a("f55d"));function n(t){return t&&t.__esModule?t:{default:t}}var s={data:function(){return{iscart:!1,list:"",car_num:"",num:"1",totalPrice:0,quantity:"",selectAllStatus:!0,number:"",car:{},edit_show:"none",cid:"",arry:[]}},onShow:function(){e.default.islogin(!0),this.carlist()},methods:{carlist:function(){var i=this;t.showLoading({mask:!0,title:"加载中..."}),t.request({url:e.default.websiteUrl+"shop/carlist",method:"POST",data:e.default.postdata({page:"1",num:"10000"}),success:function(a){200==a.data.code?(i.car=a.data.data.baseinfo,i.car.length>0?(i.iscart=!0,i.count_price()):(i.totalPrice="0",i.iscart=!1),t.hideLoading()):(t.hideLoading(),t.showToast({icon:"none",title:a.data.info}),"未找到登录信息"==a.data.info&&t.reLaunch({url:"/pages/login/login"}))},fail:function(){t.hideLoading(),t.showToast({icon:"none",title:"网络异常,请重试！"})}})},btn_minus:function(i){var a=i,e=this.car,n=e[a].Quantity;if(this.cid=e[a].ID,n<=1)return t.showToast({icon:"none",title:"数量不能小于1！"}),!1;var s=n-1;e[a].Quantity=s,this.num_but(s),this.car=e,this.count_price()},btn_add:function(t){var i=t,a=this.car,e=a[i].Quantity,n=e+1;this.cid=a[i].ID,a[i].Quantity=n,this.num_but(n),this.car=a,this.count_price()},num_but:function(i){t.request({url:e.default.websiteUrl+"shop/editcar",method:"POST",data:e.default.postdata({quantity:i,type:"1",cid:this.cid}),success:function(i){200!=i.data.code&&t.showToast({icon:"none",title:i.data.info})},fail:function(){t.hideLoading(),t.showToast({icon:"none",title:"网络异常,请重试！"})}})},selectList:function(t){var i=this,a=t,e=this.car;this.selectAllStatus=!0,e[a].selected=!e[a].selected;for(var n=e.length-1;n>=0;n--)if(!e[n].selected){i.selectAllStatus=!1;break}this.car=e,this.selectAllStatus=this.selectAllStatus,this.count_price()},count_price:function(){for(var t=this.car,i=0,a=0,e=0;e<this.car.length;e++)t[e].selected&&(i+=t[e].Quantity*t[e].Integral,a+=t[e].Quantity);this.totalPrice=i.toFixed(0),this.quantity=a},sc_but:function(){for(var i=this,a="",n="",s=0;s<this.car.length;s++)if(this.car[s].selected){var c=this.car[s].ID,o=/,$/gi;a+=c+",",n=a.replace(o,"")}t.showModal({title:"提示",content:"是否确实删除选中的商品？",success:function(a){a.confirm&&t.request({url:e.default.websiteUrl+"shop/editcar",method:"POST",data:e.default.postdata({type:"2",cid:n}),success:function(a){200==a.data.code?(t.showToast({icon:"none",title:"成功删除"}),i.carlist()):t.showToast({icon:"none",title:a.data.info})},fail:function(){t.hideLoading(),t.showToast({icon:"none",title:"网络异常,请重试！"})}})}})},js_but:function(){for(var i=this,a=0;a<this.car.length;a++)if(this.car[a].selected){var n={};n.ShopId=this.car[a].ShopId,n.Amount=this.car[a].Quantity,n.Expenditure=this.car[a].Integral,n.Details=this.car[a].ShopName,i.arry.push(n)}t.showModal({title:"提示",content:"确定结算？",success:function(a){a.confirm&&t.request({url:e.default.websiteUrl+"shop/order",method:"POST",data:e.default.postdata({studentid:e.default.getstate().userid,quantity:i.quantity,sumamount:i.totalPrice,orderitems:i.arry}),success:function(a){200==a.data.code?(t.showToast({icon:"none",title:"已完成兑换",duration:1500}),setTimeout(function(){i.carlist()},1500)):t.showToast({icon:"none",title:a.data.info})},fail:function(){t.hideLoading(),t.showToast({icon:"none",title:"网络异常,请重试！"})}})}})}}};i.default=s}).call(this,a("543d")["default"])},"4fc0":function(t,i,a){"use strict";a.r(i);var e=a("3731"),n=a.n(e);for(var s in e)"default"!==s&&function(t){a.d(i,t,function(){return e[t]})}(s);i["default"]=n.a},"555f":function(t,i,a){"use strict";var e=a("1a51"),n=a.n(e);n.a},9244:function(t,i,a){"use strict";var e=function(){var t=this,i=t.$createElement,a=t._self._c||i;return a("view",{staticClass:"content"},[a("view",{staticClass:"cart",attrs:{hidden:t.iscart}},[a("view",[t._v("购物车什么都没有，赶快去购物吧")])]),a("view",{staticClass:"uni-sp-list",attrs:{hidden:!t.iscart}},t._l(t.car,function(i,e){return a("view",{key:e,staticClass:"uni-sp-item",attrs:{"data-ShopId":i.ShopId}},[a("view",{staticClass:"checkbox"},[i.selected?a("image",{attrs:{src:"../../static/xz1.png",mode:"",eventid:"b538b74e-0-"+e},on:{tap:function(i){t.selectList(e)}}}):t._e(),a("image",{attrs:{src:"../../static/xz.png",eventid:"b538b74e-1-"+e},on:{tap:function(i){t.selectList(e)}}})]),a("view",{staticClass:"uni-title"},[t._v(t._s(i.ShopName))]),a("view",{staticClass:"uni-page"},[t._v(t._s(i.Integral)+"分")]),a("uni-icon",{staticClass:"fa fa-minus-square-o",attrs:{eventid:"b538b74e-2-"+e,mpcomid:"b538b74e-0-"+e},on:{tap:function(i){t.btn_minus(e)}}}),a("text",{staticClass:"uni-number"},[t._v(t._s(i.Quantity))]),a("uni-icon",{staticClass:"fa fa-plus-square-o",attrs:{eventid:"b538b74e-3-"+e,mpcomid:"b538b74e-1-"+e},on:{tap:function(i){t.btn_add(e)}}})],1)})),a("view",{staticClass:"uni-hj-box"},[a("view",{staticClass:"uni-hj"},[t._v("积分合计："+t._s(t.totalPrice))]),a("view",{staticClass:"uni-sc-but",attrs:{eventid:"b538b74e-4"},on:{tap:t.sc_but}},[t._v("删除")]),a("view",{staticClass:"uni-jx-but",attrs:{eventid:"b538b74e-5"},on:{tap:t.js_but}},[t._v("结算")])])])},n=[];a.d(i,"a",function(){return e}),a.d(i,"b",function(){return n})},c24d:function(t,i,a){"use strict";a.r(i);var e=a("9244"),n=a("4fc0");for(var s in n)"default"!==s&&function(t){a.d(i,t,function(){return n[t]})}(s);a("555f");var c=a("2877"),o=Object(c["a"])(n["default"],e["a"],e["b"],!1,null,null,null);i["default"]=o.exports}},[["0a77","common/runtime","common/vendor"]]]);